--- bsd.java.mk.orig	2012-11-17 06:54:17.000000000 +0100
+++ bsd.java.mk	2012-12-09 16:22:19.804648000 +0100
@@ -291,9 +291,11 @@
 A_JAVA_PORT_OS=				${A_JAVA_PORT_INFO:MOS=*:S,OS=,,}
 A_JAVA_PORT_VENDOR=			${A_JAVA_PORT_INFO:MVENDOR=*:S,VENDOR=,,}
 .if !defined(_JAVA_PORTS_INSTALLED)
-A_JAVA_PORT_INSTALLED!=		${TEST} -x "${A_JAVA_PORT_HOME}/${_JDK_FILE}" \
-							&& ${ECHO_CMD} "${A_JAVA_PORT}" \
-							|| ${TRUE}
+.if exists(${A_JAVA_PORT_HOME}/${_JDK_FILE})
+A_JAVA_PORT_INSTALLED=	${A_JAVA_PORT}
+.else
+A_JAVA_PORT_INSTALLED=
+.endif
 __JAVA_PORTS_INSTALLED!=	${ECHO_CMD} "${__JAVA_PORTS_INSTALLED} ${A_JAVA_PORT_INSTALLED}"
 .endif
 
@@ -304,11 +306,13 @@
 # 
 # We can't do this in make because it doesn't allow nested modifiers ${foo:${bar}}
 #
-A_JAVA_PORT_POSSIBLE!=		ver="${_JAVA_VERSION}"; os="${_JAVA_OS}"; vendor="${_JAVA_VENDOR}"; \
-				${TEST} "$${ver\#*${A_JAVA_PORT_VERSION}*}" != "${_JAVA_VERSION}" -a \
-				"$${os\#*${A_JAVA_PORT_OS}*}" != "${_JAVA_OS}" -a \
-				"$${vendor\#*${A_JAVA_PORT_VENDOR}*}" != "${_JAVA_VENDOR}" && \
-				${ECHO_CMD} "${A_JAVA_PORT}" || ${TRUE}
+.if "${_JAVA_VERSION:S/${A_JAVA_PORT_VERSION}//}" != "${_JAVA_VERSION}" && \
+    "${_JAVA_OS:S/${_A_JAVA_PORT_OS}//}"          != "${_JAVA_OS}" && \
+    "${_JAVA_VENDOR:S/${_A_JAVA_PORT_VENDOR}//}"  != "${_JAVA_VENDOR}"
+A_JAVA_PORT_POSSIBLE=	${A_JAVA_PORT}
+.else
+A_JAVA_PORT_POSSIBLE=
+.endif
 __JAVA_PORTS_POSSIBLE:=		${__JAVA_PORTS_POSSIBLE} ${A_JAVA_PORT_POSSIBLE}
 .		endfor
 .if !defined(_JAVA_PORTS_INSTALLED)
@@ -326,9 +330,11 @@
 .		undef _JAVA_PORTS_INSTALLED_POSSIBLE
 
 .		for A_JAVA_PORT in ${_JAVA_PORTS_POSSIBLE}
-A_JAVA_PORT_INSTALLED_POSSIBLE!=	inst="${_JAVA_PORTS_INSTALLED}"; \
-					${TEST} "$${inst\#*${A_JAVA_PORT}*}" != "${_JAVA_PORTS_INSTALLED}" && \
-					${ECHO_CMD} "${A_JAVA_PORT}" || ${TRUE}
+.if "${_JAVA_PORTS_INSTALLED:S/${A_JAVA_PORT}//}" != "${_JAVA_PORTS_INSTALLED}"
+A_JAVA_PORT_INSTALLED_POSSIBLE= ${A_JAVA_PORT}
+.else
+A_JAVA_PORT_INSTALLED_POSSIBLE=
+.endif
 __JAVA_PORTS_INSTALLED_POSSIBLE:=	${__JAVA_PORTS_INSTALLED_POSSIBLE} ${A_JAVA_PORT_INSTALLED_POSSIBLE}
 .		endfor
 _JAVA_PORTS_INSTALLED_POSSIBLE=		${__JAVA_PORTS_INSTALLED_POSSIBLE:C/[ ]+//g}
@@ -411,7 +417,7 @@
 
 # Then test if a JAVAC has to be set (JAVA_BUILD==jdk)
 .		if defined(JAVA_BUILD)
-.			if (${JAVA_BUILD:U} == "JDK") && !defined(JAVAC)
+.			if (${JAVA_BUILD:tu} == "JDK") && !defined(JAVAC)
 JAVAC?=			${JAVA_HOME}/bin/javac
 .			endif
 .		endif
