--- Makefile.orig	2014-07-05 08:16:59.284817000 +0000
+++ Makefile
@@ -19,11 +19,11 @@ CONFLICTS=	LPRng-[0-9]*
 
 UNIQUENAME=	${PORTNAME}${PKGNAMESUFFIX}
 
-USES+=		gmake pkgconfig tar:bzip2
+USES+=		gmake pkgconfig iconv tar:bzip2
 DESTDIRNAME=	DSTROOT
 GNU_CONFIGURE=	yes
 CPPFLAGS+=	-I${LOCALBASE}/include
-LDFLAGS+=	-L${LOCALBASE}/lib
+LDFLAGS+=	-L${LOCALBASE}/lib ${ICONV_LIB}
 DSOFLAGS=	-Wl,-rpath,${PREFIX}/lib ${LDFLAGS} ${LIBS}
 CONFIGURE_ENV=	DSOFLAGS="${DSOFLAGS}"
 CONFIGURE_ARGS+=	--localstatedir=/var			\
@@ -41,7 +41,6 @@ CONFIGURE_ARGS+=	--localstatedir=/var
 CUPS_CACHEDIR?=	/var/db/cups
 CUPS_SPOOLDIR=	/var/spool/cups
 CUPS_SOCKET?=	/var/run/cups.sock
-CUPS_PDFTOPS?=	${LOCALBASE}/libexec/xpdf/pdftops
 WRKSRC=		${WRKDIR}/${PORTNAME}-${DISTVERSION}
 
 CUPSSYSGRP=	wheel
@@ -88,12 +87,14 @@ ZEROCONF_DESC=		Zeroconf support
 
 .include <bsd.port.options.mk>
 
+.if !empty(ICONV_LIB)
+CONFIGURE_ENV+=	ac_cv_search_iconv_open=-liconv
+.endif
+
 .if defined(CUPS_CLIENT)
 COMMENT2=	Library cups
 INSTALL_WRKSRC=	${WRKSRC}/cups
 PLIST=		${MASTERDIR}/pkg-plist.client
-USES+=		iconv
-LIBS+=		${ICONV_LIB}
 USE_LDCONFIG=	yes
 PKGMESSAGE=	${NONEXISTENT}
 DESCR=		${MASTERDIR}/pkg-descr.client
@@ -199,6 +200,7 @@ RUN_DEPENDS+=		xdg-open:${PORTSDIR}/deve
 .endif
 
 .if !defined(CUPS_CLIENT) && !defined(CUPS_IMAGE) && ${PORT_OPTIONS:MLIBUSB}
+USES+=			usb
 CONFIGURE_ARGS+=	--enable-libusb
 .else
 CONFIGURE_ARGS+=	--disable-libusb
@@ -222,7 +224,7 @@ post-patch:
 	@${REINPLACE_CMD} -e 's|@PIEFLAGS@||' ${WRKSRC}/Makedefs.in
 .endif
 .if ${PORT_OPTIONS:MMDNSRESPONDER}
-	@${REINPLACE_CMD} -e 's|Darwin|FreeBSD|' \
+	@${REINPLACE_CMD} -e 's|Darwin|${OPSYS}|' \
 		${WRKSRC}/backend/Makefile
 .endif
 .if  ${PORT_OPTIONS:MXDG_OPEN}
