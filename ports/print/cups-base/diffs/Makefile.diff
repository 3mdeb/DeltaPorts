--- Makefile.orig	2014-05-05 14:28:02.263762000 +0000
+++ Makefile
@@ -19,12 +19,12 @@ CONFLICTS=	LPRng-[0-9]*
 
 UNIQUENAME=	${PORTNAME}${PKGNAMESUFFIX}
 
-USES+=		gmake pkgconfig tar:bzip2
+USES+=		gmake pkgconfig iconv tar:bzip2
 DESTDIRNAME=	DSTROOT
 GNU_CONFIGURE=	yes
 CFLAGS+=	${PTHREAD_CFLAGS}
 CPPFLAGS+=	-I${LOCALBASE}/include
-LDFLAGS+=	-L${LOCALBASE}/lib
+LDFLAGS+=	-L${LOCALBASE}/lib ${ICONV_LIB}
 DSOFLAGS=	-Wl,-rpath,${PREFIX}/lib -L${PREFIX}/lib ${LDFLAGS}
 CONFIGURE_ENV=	DSOFLAGS="${DSOFLAGS}"
 CONFIGURE_ARGS+=	--localstatedir=/var			\
@@ -42,7 +42,6 @@ CONFIGURE_ARGS+=	--localstatedir=/var
 CUPS_CACHEDIR?=	/var/db/cups
 CUPS_SPOOLDIR=	/var/spool/cups
 CUPS_SOCKET?=	/var/run/cups.sock
-CUPS_PDFTOPS?=	${LOCALBASE}/libexec/xpdf/pdftops
 WRKSRC=		${WRKDIR}/${PORTNAME}-${DISTVERSION}
 
 CUPSSYSGRP=	wheel
@@ -75,12 +74,14 @@ XDG_OPEN_DESC=		Build with XDG_OPEN as b
 
 .include <bsd.port.options.mk>
 
+.if !empty(ICONV_LIB)
+CONFIGURE_ENV+=	ac_cv_search_iconv_open=-liconv
+.endif
+
 .if defined(CUPS_CLIENT)
 COMMENT2=	Library cups
 INSTALL_WRKSRC=	${WRKSRC}/cups
 PLIST=		${MASTERDIR}/pkg-plist.client
-USES+=		iconv
-LDFLAGS+=	${ICONV_LIB}
 USE_LDCONFIG=	yes
 PKGMESSAGE=	${NONEXISTENT}
 DESCR=		${MASTERDIR}/pkg-descr.client
@@ -192,6 +193,7 @@ RUN_DEPENDS+=		xdg-open:${PORTSDIR}/deve
 .if !defined(CUPS_CLIENT) && !defined(CUPS_IMAGE) && ${PORT_OPTIONS:MLIBUSB}
 CPPFLAGS+=		-I/usr/include
 LDFLAGS+=		-L/usr/lib
+USES+=			usb
 CONFIGURE_ARGS+=	--enable-libusb
 .else
 CONFIGURE_ARGS+=	--disable-libusb
@@ -205,7 +207,7 @@ PLIST_SUB+=		WITH_ICONS=""
 PLIST_SUB+=		WITH_ICONS="@comment "
 .endif
 
-CONFIGURE_ARGS+=	LIBS="-lssp_nonshared"
+#CONFIGURE_ARGS+=	LIBS="-lssp_nonshared"
 
 .if ! defined(CUPS_CLIENT) && ! defined(CUPS_IMAGE)
 SUB_FILES+=	ulpt-cupsd.conf ulpt-cupsd.sh
@@ -292,6 +294,7 @@ post-install:
 	${INSTALL_DATA} ${WRKSRC}/cups/raster.h ${STAGEDIR}${PREFIX}/include/cups
 .else
 .if  ${PORT_OPTIONS:MGHOSTSCRIPT} || ${PORT_OPTIONS:MXPDF}
+	${INSTALL} -d ${PREFIX}/libexec/cups/filter
 	${INSTALL_PROGRAM} ${WRKSRC}/filter/pdftops  ${STAGEDIR}${PREFIX}/libexec/cups/filter/
 .endif
 	${LN} -sf lpr ${STAGEDIR}${PREFIX}/bin/lpr-cups
