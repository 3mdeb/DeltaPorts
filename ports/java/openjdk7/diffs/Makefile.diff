--- Makefile.orig	2013-08-14 08:33:51.379805000 +0000
+++ Makefile
@@ -15,10 +15,13 @@ MASTER_SITES=	http://download.java.net/o
 		http://icedtea.classpath.org/download/drops/:jaxws \
 		https://java.net/downloads/jax-ws/JDK7/:jaf \
 		http://icedtea.classpath.org/download/drops/:jaf \
+		http://dl.wolfpond.org/openjdk7/:bootstrap \
 		${MASTER_SITE_APACHE:S,%SUBDIR%/,ant/binaries/:ant,}
 DISTFILES=	${JDK_SRC_DISTFILE}${EXTRACT_SUFX} \
+		${BOOTSTRAP_DISTFILE}:bootstrap \
 		${ANT_DISTFILE}${EXTRACT_SUFX}:ant
 EXTRACT_ONLY=	${JDK_SRC_DISTFILE}${EXTRACT_SUFX} \
+		${BOOTSTRAP_DISTFILE} \
 		${ANT_DISTFILE}${EXTRACT_SUFX}
 
 MAINTAINER=	glewis@FreeBSD.org
@@ -28,11 +31,10 @@ LICENSE=	GPLv2
 
 WRKSRC=		${WRKDIR}/${PORTNAME}
 
-USE_ZIP=	yes
+EXTRACT_SUFX=	.zip
 USE_GMAKE=	yes
 USES=		iconv
 USE_XORG+=	x11 xext xi xrender xt xtst
-MAKE_JOBS_UNSAFE=	yes
 
 OPTIONS_DEFINE=		DEBUG POLICY TZUPDATE
 OPTIONS_DEFAULT=	POLICY TZUPDATE
@@ -58,15 +60,19 @@ LIB_DEPENDS+=	freetype:${PORTSDIR}/print
 		asound:${PORTSDIR}/audio/alsa-lib
 BUILD_DEPENDS+=	zip:${PORTSDIR}/archivers/zip \
 		unzip:${PORTSDIR}/archivers/unzip \
+		javavm:${PORTSDIR}/java/javavmwrapper \
 		${LOCALBASE}/include/cups/cups.h:${PORTSDIR}/print/cups-client
 RUN_DEPENDS+=	javavm:${PORTSDIR}/java/javavmwrapper \
 		${LOCALBASE}/lib/X11/fonts/dejavu:${PORTSDIR}/x11-fonts/dejavu
 
 USE_DOS2UNIX=	jdk/src/share/classes/com/sun/org/apache/xml/internal/security/resource/xmlsecurity_en.properties
 
-OPENJDK_OSARCH=	bsd-${ARCH:S/i386/i586/}
+JDK_ARCH=	${ARCH:S/x86_64/amd64/}
+OPENJDK_OSARCH=	bsd-${JDK_ARCH:S/i386/i586/}
 INSTALLDIR=	${PREFIX}/${PORTNAME}${JDK_MAJOR_VERSION}
 
+BOOTSTRAP_DISTFILE=	bootstrap-openjdk-7.9.05_2.dfly-3.3-${JDK_ARCH}.tar.xz
+BOOTSTRAP_LIBDIRS=	${BOOTSTRAPJDKDIR}/jre/lib/${JDK_ARCH}
 NOPRECIOUSMAKEVARS=	yes
 
 ONLY_FOR_ARCHS=	i386 amd64
@@ -76,7 +82,7 @@ MAKE_ENV+=	LANG="C" \
 		LC_ALL="C" \
 		JAVA_HOME="" \
 		CLASSPATH="" \
-		LD_LIBRARY_PATH="" \
+		LD_LIBRARY_PATH="${BOOTSTRAP_LIBDIRS}" \
 		MAKEFLAGS="" \
 		ALT_BOOTDIR="${BOOTSTRAPJDKDIR}" \
 		ALT_FREETYPE_HEADERS_PATH="${LOCALBASE}/include" \
@@ -101,10 +107,7 @@ MAKE_ENV+=	LANG="C" \
 		BUILD_NUMBER="b${PORT_BUILD_NUMBER}"
 
 MAKE_ENV+=	HOTSPOT_BUILD_JOBS=${MAKE_JOBS_NUMBER}
-
-BOOTSTRAP_JDKS=	${LOCALBASE}/openjdk7 \
-		${LOCALBASE}/openjdk6 \
-		${LOCALBASE}/bootstrap-openjdk
+MAKE_ENV+=	ALT_PARALLEL_COMPILE_JOBS=${MAKE_JOBS_NUMBER}
 
 SECURITY_ICONS= security-icon-bw16.png \
 		security-icon-bw24.png \
@@ -121,6 +124,10 @@ SECURITY_ICONS= security-icon-bw16.png \
 
 .include <bsd.port.options.mk>
 
+.if ${OPSYS} == DragonFly && ${DFLYVERSION} > 300500
+BOOTSTRAP_DISTFILE= bootstrap-openjdk-7.21.11.dfly-3.5-${JDK_ARCH}.tar.xz
+.endif
+
 .if empty(PORT_OPTIONS:MDEBUG)
 MAKE_ENV+=	ALT_OBJCOPY="/nonexistent"
 .endif
@@ -129,23 +136,7 @@ MAKE_ENV+=	ALT_OBJCOPY="/nonexistent"
 RUN_DEPENDS+=  ${LOCALBASE}/share/java/zi:${PORTSDIR}/java/java-zoneinfo
 .endif
 
-# do we have valid native jdk installed?
-.for BJDK in ${BOOTSTRAP_JDKS}
-.  if !defined(BOOTSTRAPJDKDIR) && exists(${BJDK}/bin/javac)
-BOOTSTRAPJDKDIR=	${BJDK}
-.  endif
-.endfor
-
-# if no valid jdk found, set dependency
-.if !defined(BOOTSTRAPJDKDIR)
-BOOTSTRAPJDKDIR?=	${LOCALBASE}/bootstrap-openjdk
-BUILD_DEPENDS+=		${BOOTSTRAPJDKDIR}/bin/javac:${PORTSDIR}/java/bootstrap-openjdk
-.endif
-
-.if ${OSVERSION} < 800000
-PATCH_DEPENDS+=	gpatch:${PORTSDIR}/devel/patch
-PATCH=		gpatch
-.endif
+BOOTSTRAPJDKDIR=	${WRKDIR}/bootstrap
 
 post-extract:
 	# Move icons to their new home.
@@ -163,6 +154,11 @@ post-patch:
 		${WRKSRC}/jdk/make/javax/crypto/Makefile
 .endif
 
+# override do-build to filter out _MAKE_JOBS to enable parallel build
+do-build:
+	@cd ${WRKSRC} && ${SETENV} ${MAKE_ENV} ${MAKE_CMD} \
+		${MAKE_FLAGS} ${MAKEFILE} ${MAKE_ARGS} ${ALL_TARGET}
+
 .if ${PORT_OPTIONS:MTZUPDATE}
 pre-install:
 	@# Update time zones
@@ -180,8 +176,8 @@ do-install:
 		${CHOWN} -h -R ${BINOWN}:${BINGRP} $$dir; \
 		${FIND} $$dir -type f -exec ${CHMOD} ${BINMODE} "{}" \; ; \
 	done
-	@${CHOWN} ${BINOWN}:${BINGRP} ${INSTALLDIR}/jre/lib/${ARCH}/jexec
-	@${CHMOD} ${BINMODE} ${INSTALLDIR}/jre/lib/${ARCH}/jexec
+	@${CHOWN} ${BINOWN}:${BINGRP} ${INSTALLDIR}/jre/lib/${JDK_ARCH}/jexec
+	@${CHMOD} ${BINMODE} ${INSTALLDIR}/jre/lib/${JDK_ARCH}/jexec
 	@${INSTALL_DATA} ${FILESDIR}/cacerts ${INSTALLDIR}/jre/lib/security/cacerts
 	@${ECHO} "@unexec ${LOCALBASE}/bin/unregistervm ${INSTALLDIR}/bin/java" >> ${TMPPLIST}
 	@${FIND} -s ${INSTALLDIR} -not -type d | ${SORT} | \
