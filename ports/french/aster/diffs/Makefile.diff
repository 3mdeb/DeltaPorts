--- Makefile.orig	2013-03-21 14:27:38.093717000 +0000
+++ Makefile
@@ -33,9 +33,9 @@ BUILD_DEPENDS+=	${LOCALBASE}/aster/ASTK/
 		${SHELL_INSTALL_ASTER}:${PORTSDIR}/shells/${SHIADEP}		\
 		${PYNUMPY}
 LIB_DEPENDS+=	hdf5.7:${PORTSDIR}/science/hdf5-18				\
-		med.5:${PORTSDIR}/french/med
+		med.5:${PORTSDIR}/french/med					\
+		metis:${PORTSDIR}/math/metis-edf
 RUN_DEPENDS+=	${PYTHON_SITELIBDIR}/Gnuplot:${PORTSDIR}/math/py-gnuplot	\
-		${LOCALBASE}/bin/onmetis.exe:${PORTSDIR}/math/metis-edf		\
 		${SHELL_INSTALL_ASTER}:${PORTSDIR}/shells/${SHIADEP}		\
 		${LOCALBASE}/aster/ASTK/ASTK_SERV:${PORTSDIR}/cad/astk-serveur
 
@@ -183,9 +183,8 @@ WITH_ED=	vi
 .endif
 
 vaster=		STA${PORTVERSION:R:R}
-INST_DAT=	LICENSE.TERMS astest cata_ele.pickled catalo catapy	\
-		elements materiau
-INST_PY=	bibpyt commande
+INST_DAT=	LICENSE.TERMS astest catalo catapy materiau
+INST_PY=	bibpyt
 INST_SH=	as_run parallel_cp
 DAT2FIX=	astout.export config.txt forma01a.export
 inst_dir=	${PREFIX}/${PORTNAME}/${vaster}
@@ -319,6 +318,9 @@ pre-configure:
 	${PYTHON_CMD} ${PYTHON_LIBDIR}/compileall.py ${WRKSRC}
 	@${PYTHON_CMD} -O ${PYTHON_LIBDIR}/compileall.py ${WRKSRC}
 
+post-patch:
+	${REINPLACE_CMD} -e 's|/usr/ports/french/aster/work|${WRKDIR}|g' ${WRKSRC}/products.py
+
 do-configure:
 	(cd ${CONFIGURE_WRKSRC} && ${PYTHON_CMD} setup.pyo ${DEBUG_FLAGS} test	\
 		| tee ${CONFIGURE_LOG})
@@ -350,8 +352,6 @@ do-build:
 
 do-install:
 	${MKDIR} ${tools_dir} ${inst_dir} ${PREFIX}/${PORTNAME}/bin
-	${INSTALL_PROGRAM} ${WRKSRC}/instdir/${vaster}/asteru ${inst_dir}
-	#${INSTALL_SCRIPT} ${WRKSRC}/instdir/${vaster}/asterd ${inst_dir} # Don't strip!
 	${INSTALL_SCRIPT} ${WRKSRC}/instdir/${vaster}/profile.sh ${inst_dir}
 	${ECHO_CMD} "" >> ${inst_dir}/profile.sh
 	${ECHO_CMD} "HDF5_DISABLE_VERSION_CHECK=1" >> ${inst_dir}/profile.sh
