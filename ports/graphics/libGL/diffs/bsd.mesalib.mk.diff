--- bsd.mesalib.mk.orig	2013-11-06 23:06:17.952977000 +0000
+++ bsd.mesalib.mk
@@ -11,7 +11,6 @@
 #
 # $FreeBSD: graphics/libGL/bsd.mesalib.mk 328711 2013-09-29 17:01:41Z zeising $
 
-.MAKE.FreeBSD_UL=	yes
 
 MESAVERSION=	${MESABASEVERSION}${MESASUBVERSION:C/^(.)/.\1/}
 MESADISTVERSION=${MESABASEVERSION}${MESASUBVERSION:C/^(.)/-\1/}
@@ -70,8 +69,12 @@ SHEBANG_FILES=	src/gallium/*/*/*.py src/
 		src/gallium/drivers/svga/svgadump/svga_dump.py \
 		src/glsl/tests/compare_ir src/mapi/glapi/gen/*.py \
 		src/mapi/mapi/mapi_abi.py
+EXTRA_PATCHES+= ${DFLY_PATCHDIR}/extra-newxorg-src_gallium_include_pipe_p__config.h
 .else
 CONFIGURE_ARGS+=--disable-glut --disable-glw --disable-glu
+EXTRA_PATCHES+= ${DFLY_PATCHDIR}/extra-oldxorg-bin_mklib \
+		${DFLY_PATCHDIR}/extra-oldxorg-src_gallium_include_pipe_p__config.h
+
 
 ALL_TARGET=		default
 .endif
@@ -82,11 +85,12 @@ PATCHDIR=		${MASTERDIR}/files
 .else
 PATCHDIR=		${MASTERDIR}/files-old
 .endif
+DFLY_PATCHDIR=		${MASTERDIR}/dragonfly
 DESCR=			${.CURDIR}/pkg-descr
 PLIST=			${.CURDIR}/pkg-plist
 WRKSRC=			${WRKDIR}/Mesa-${MESADISTVERSION}
 
-COMPONENT=		${PORTNAME:L:C/^lib//:C/mesa-//}
+COMPONENT=		${PORTNAME:tl:C/^lib//:C/mesa-//}
 
 .if ${COMPONENT:Mglesv2} == ""
 CONFIGURE_ARGS+=	--disable-gles2
@@ -116,8 +120,6 @@ CONFIGURE_ARGS+=	--enable-xcb
 .endif
 
 post-patch:
-	@${REINPLACE_CMD} -e 's|-ffast-math|${FAST_MATH}|' -e 's|x86_64|amd64|' \
-		${WRKSRC}/configure
 	@${REINPLACE_CMD} -e 's|/etc/|${PREFIX}/etc/|g' \
 		${WRKSRC}/src/mesa/drivers/dri/common/xmlconfig.c
 .if !defined(WITH_NEW_XORG)
