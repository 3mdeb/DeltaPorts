--- bsd.mesalib.mk.orig	2014-05-05 13:44:50.585941000 +0000
+++ bsd.mesalib.mk
@@ -68,8 +68,12 @@ SHEBANG_FILES=	src/gallium/*/*/*.py src/
 		src/gallium/drivers/svga/svgadump/svga_dump.py \
 		src/glsl/tests/compare_ir src/mapi/glapi/gen/*.py \
 		src/mapi/mapi/mapi_abi.py
+EXTRA_PATCHES+= ${DFLY_PATCHDIR}/extra-newxorg-src_gallium_include_pipe_p__config.h
 .else
 CONFIGURE_ARGS+=--disable-glut --disable-glw --disable-glu
+EXTRA_PATCHES+= ${DFLY_PATCHDIR}/extra-oldxorg-bin_mklib \
+		${DFLY_PATCHDIR}/extra-oldxorg-src_gallium_include_pipe_p__config.h
+
 
 ALL_TARGET=		default
 .endif
@@ -80,6 +84,7 @@ PATCHDIR=		${MASTERDIR}/files
 .else
 PATCHDIR=		${MASTERDIR}/files-old
 .endif
+DFLY_PATCHDIR=		${MASTERDIR}/dragonfly
 DESCR=			${.CURDIR}/pkg-descr
 PLIST=			${.CURDIR}/pkg-plist
 WRKSRC=			${WRKDIR}/Mesa-${MESADISTVERSION}
@@ -114,8 +119,6 @@ CONFIGURE_ARGS+=	--enable-xcb
 .endif
 
 post-patch:
-	@${REINPLACE_CMD} -e 's|-ffast-math|${FAST_MATH}|' -e 's|x86_64|amd64|' \
-		${WRKSRC}/configure
 	@${REINPLACE_CMD} -e 's|/etc/|${PREFIX}/etc/|g' \
 		${WRKSRC}/src/mesa/drivers/dri/common/xmlconfig.c
 .if !defined(WITH_NEW_XORG)
